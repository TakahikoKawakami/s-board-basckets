{% extends "base.pug" %}
{% block body %}

#basket__main
    h1 分析結果
    hr
    #basket-container
        h2 Pick Up!
        .summary
            div.
                {{ pickUpMessage.store.storeName }}店舗の{{ pickUpMessage.from }}から{{ pickUpMessage.to }}の期間、<br>
                {% if pickUpMessage.productFrom == None %}
                取引が存在しないか、関係性を見つけられませんでした。<br>
                分析期間を変更して、再度分析してみてください。
            
                {% else %}
                <br>
            .summary__productFrom.
                (
                {% for product in pickUpMessage.productFrom %}
                {{product.label}}, 
                {% endfor %}
                )
            div.
                の組み合わせを購入したお客様は、<br>
            .summary__productTo.
                (
                {% for product in pickUpMessage.productTo %}
                {{product.label}}, 
                {% endfor %}
                )
            div.
                の組み合わせも一緒に購入されることが多いようです。<br><br>
                この結果から考えられる人物像に向け、
                <br>
                新たな商品や商品配置を考えてみましょう！
            {% endif %}

        hr
        .basket-network 
            h2 ネットワーク図
            a 見方はこちら
            .graph
                #network
                #circle-option.circle-option
                    span.el-icon-edit.
                        edit
                    span.el-icon-delete.
                        delete
                    span.el-icon-help.
                        help
                    span.el-icon-close.
                        close
        hr
        button
            a(href="/baskets/index") 条件を変えてもう一度分析する 

//- datepicker.js
//- link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css")
//- script(src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js")
//- script(src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js")

//- vis.js	
link(rel="stypesheet", href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css")
script(type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js")
script.
    var nodes = new vis.DataSet({{ nodes | tojson }});
    var edges = new vis.DataSet({{ edges | tojson }});
    var container = document.getElementById('network');
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {
        nodes: {
            shape: "dot",
        }
    };
    var network = new vis.Network(container, data, options);
    
      // 点击鼠标事件
    this.network.on("click", (e) => {
        this.selectedId = e.nodes[0];
        if (e.nodes.length) {
            let p = this.network.getPositions(e.nodes[0]);
            let nodeId = e.nodes[0];
            console.log(p[nodeId]);
            // 获取缩放尺寸
            let scale = this.network.getScale();
            // canvas->dom 坐标转化
            let domPosi = this.network.canvasToDOM({
                x: p[nodeId]["x"],
                y: p[nodeId]["y"],
        });
        console.log("domPosi ", domPosi["x"], domPosi["y"]);
        // 设置环形位置;
        this.setCirclePostion(
            domPosi["x"],// - 42,
            domPosi["y"],// + 10,
            scale + 0.4
        );
        } else {
        this.hideCircle();
        }
    });
        //  设置环形位置
    function setCirclePostion(x, y, scale) {
        let circle = document.getElementById("circle-option");
        //- circle.style = `left: ${x}px; top: ${y}px;transform:scale(${scale});display:block;`;
        circle.style = 'display: block;';
    };
    // 隐藏圆环选项
    function hideCircle() {
        let circle = document.getElementById("circle-option");
        circle.style = 'display:none;';
    };
style.
    ranking{
    margin: 0;
    padding: 0;
    list-style-type: none;
    }
    .ranking li{
    position: relative;
    margin: 0;
    padding: 0 0 0 16px;
    border-bottom: 1px dotted #ccc;
    }
    .ranking li::before{
    position: absolute;
    top: 7px;
    left: 1px;
    color: #d05;
    content: "★";
    font-size: 9px;
    }
    .ranking li:first-child::before,
    .ranking li:nth-child(2)::before,
    .ranking li:nth-child(3)::before{
    position: absolute;
    top: 1px;
    left: 0;
    width: 0;
    height: 0;
    border: 6px solid transparent;
    border-bottom: 10px solid #fb0;
    content: "";
    }
    .ranking li:first-child::after,
    .ranking li:nth-child(2)::after,
    .ranking li:nth-child(3)::after{
    position: absolute;
    top: 9px;
    left: 0;
    width: 0;
    height: 0;
    border: 6px solid #fb0;
    border-top: 3px solid transparent;
    border-bottom: 6px solid #f90;
    content: "";
    }
    .ranking li:nth-child(2)::before{
    border-bottom: 10px solid #ccc;
    }
    .ranking li:nth-child(2)::after{
    border: 6px solid #ccc;
    border-top: 3px solid transparent;
    border-bottom: 6px solid #aaa;
    }
    .ranking li:nth-child(3)::before{
    border-bottom: 10px solid #d98;
    }
    .ranking li:nth-child(3)::after{
    border: 6px solid #d98;
    border-top: 3px solid transparent;
    border-bottom: 6px solid #c76;
    }
    .ranking li span{
    color: #9ab;
    font-size: 11px;
    }

style(lang="less").
    .circle-option {
    position: absolute;
    left: 0px;
    top: 0px;
    width: 100px;
    height: 100px;
    border: 30px solid rgba(200, 200, 200, 0.7);
    border-radius: 50px;
    box-sizing: border-box;
    z-index: 10;
    display: none;
    span {
        position: absolute;
        left: 0;
        right: 0;
        width: 30px;
        height: 20px;
        line-height: 20px;
        text-align: center;
        font-size: 10px;
        color: white;
        cursor: pointer;
        &:hover {
        color: #1b68ff;
        }
        &:nth-child(1) {
        left: 5px;
        top: -25px;
        }
    
        &:nth-child(2) {
        left: 37px;
        top: 10px;
        }
    
        &:nth-child(3) {
        left: 5px;
        top: 44px;
        }
    
        &:nth-child(4) {
        left: -27px;
        top: 10px;
        }
    }
    }
{% endblock %}
