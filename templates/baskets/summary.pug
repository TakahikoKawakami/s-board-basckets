{% extends "base.pug" %}
{% block body %}

#basket-main
    h1 バスケット分析
    #basket-container
        #basket-search
            form(action="", method="get")
                .form-group
                    .item
                        label(for="search-from") 分析開始日
                        input#search-from.datepicker(name="", placeholder="")
                    .item
                        label(for="search-to") 分析終了日
                        input#search-to.datepicker(name="", placeholder="")
                    .item
                        button#search-expand-btn button
                    .item
                        button#search-expand-btn 検索条件を保存
                #search-expand.expand
                    .button__radio
                        div.
                            分析対象
                        //- input -> label の順番（cssの関係）
                        input#target-category(type="radio" name="target" value="0" checked=true)
                        label(for="target-category") 部門
                        input#target-product(type="radio" name="target" value="1" checked=false)
                        label(for="target-product") 商品
                    .button__radio
                        div.
                            対象店舗
                        //- input -> label の順番（cssの関係）
                        input#target-category(type="radio" name="target" value="0" checked=true)
                        label(for="target-category") 部門
                        input#target-product(type="radio" name="target" value="1" checked=false)
                        label(for="target-product") 商品

                button(href="" style="width: 80%; text-align: center;") 分析
        .summary Pick Up!
            p.
                この期間、xxx時からyyy時の間で、product1とproduct2を一緒に購入している、
                customerGroupのgenderが多い
            p.
                この結果から考えられる人物像に向け、新たな商品や商品配置を考えてみましょう！
        .basket-ranking 
            h2 購入数ランキング
            ul.ranking
                {% for rank in ranking %}
                li 
                    div(style="display:grid; grid-template-rows:1fr 1fr")
                        dev(style="font-size: 24px;") {{ rank.label }} {{rank.value}}回
                        dev(style="text-align: right") 最も一緒に購入された商品 {{rank.relations}}
                    //-     dev(class="list__expand_btn__" + i) button
                    //- ul(class="list__extend__" + i).expand.ranking
                    //-     li test-test1
                    //-     li test-test2
                    //-     li test-test3
                {% endfor %}
        .basket-network 
            h2 相関図
            .graph
                #network
//- datepicker.js
link(rel="stylesheet", href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css")
script(src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js")
script(src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js")

//- vis.js	
link(rel="stypesheet", href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css")
script(type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js")
script.
    $("#search-expand-btn").on('click', function() {
        $("#search-expand").slideToggle();
        return false;
    });
    //- for i in range(0, 3):
    //-     $("#list__expand__btn__" + i).on('click', function() {
    //-         $("#list__expand__" + i).slideToggle();
    //-         return false;
    //-     });
    
    $(".datepicker").datepicker({
        dateFormat: 'yy-mm-dd',
        firstDay: 0, //0?6　0が日曜、1が月曜、2が火曜・・・・6が土曜
        monthNames: [ "1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月" ]// 初期値[ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ]
    });
    
    var nodes = new vis.DataSet({{ nodes | tojson }});
    var edges = new vis.DataSet({{ edges | tojson }});
    var container = document.getElementById('network');
    var data = {
        nodes: nodes,
        edges: edges
    };
    var options = {
        nodes: {
            shape: "dot",
        }
    };
    var network = new vis.Network(container, data, options);
    
    network.on("click", function(params) {
        if (params.nodes.length == 1) {
            var nodeId = params.nodes[0];
            var node = nodes.get(nodeId);
            console.log(node.label + 'がクリックされました');
        }
    });
style.
    ranking{
    margin: 0;
    padding: 0;
    list-style-type: none;
    }
    .ranking li{
    position: relative;
    margin: 0;
    padding: 0 0 0 16px;
    border-bottom: 1px dotted #ccc;
    }
    .ranking li::before{
    position: absolute;
    top: 7px;
    left: 1px;
    color: #d05;
    content: "★";
    font-size: 9px;
    }
    .ranking li:first-child::before,
    .ranking li:nth-child(2)::before,
    .ranking li:nth-child(3)::before{
    position: absolute;
    top: 1px;
    left: 0;
    width: 0;
    height: 0;
    border: 6px solid transparent;
    border-bottom: 10px solid #fb0;
    content: "";
    }
    .ranking li:first-child::after,
    .ranking li:nth-child(2)::after,
    .ranking li:nth-child(3)::after{
    position: absolute;
    top: 9px;
    left: 0;
    width: 0;
    height: 0;
    border: 6px solid #fb0;
    border-top: 3px solid transparent;
    border-bottom: 6px solid #f90;
    content: "";
    }
    .ranking li:nth-child(2)::before{
    border-bottom: 10px solid #ccc;
    }
    .ranking li:nth-child(2)::after{
    border: 6px solid #ccc;
    border-top: 3px solid transparent;
    border-bottom: 6px solid #aaa;
    }
    .ranking li:nth-child(3)::before{
    border-bottom: 10px solid #d98;
    }
    .ranking li:nth-child(3)::after{
    border: 6px solid #d98;
    border-top: 3px solid transparent;
    border-bottom: 6px solid #c76;
    }
    .ranking li span{
    color: #9ab;
    font-size: 11px;
    }

{% endblock %}
